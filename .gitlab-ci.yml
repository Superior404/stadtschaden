image: node:18

stages:
  - test

variables:
  BRANCH_NAME: $CI_COMMIT_REF_NAME

before_script:
  - npm install

test_job:
  stage: test
  tags:
    - test
    - npm
  script:
    - |
      if [ "$BRANCH_NAME" == "staging" ]; then
        cp .env.staging .env
      elif [ "$BRANCH_NAME" == "main" ]; then
        cp .env.prod .env
      fi
    - npm run test
    - npm run lint
    - npm run prettier:check
